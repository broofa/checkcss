<html>
  <head>
    <meta http-equiv="Content-Security-Policy" content="" />
    <title>Browser Test</title>

    <script type="module">
      import { CheckCSS } from '../dist/index.js';

      const LAZY_CLASS = 'text-bg-primary';
      const MISSING_CLASS = 'MiSsInG_ClAsS';

      function assert(condition, message) {
        if (!condition) {
          throw new Error(message);
        }
      }

      function lazyAddLink() {
        const linkEl = document.createElement('link');
        linkEl.setAttribute('rel', 'stylesheet');
        linkEl.href =
          'https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css';

        const divEl = document.createElement('div');
        divEl.className = LAZY_CLASS;
        divEl.innerHTML = 'Lazy-loaded CSS should be available.';

        document.body.append(linkEl);
        document.body.append(divEl);
      }

      async function runChecks(checkcss) {
        const state = checkcss._state;
        console.log('FDJAFDS', state);
        assert(
          state.get(MISSING_CLASS) === 0,
          `{$MISSING_CLASS} should be detected`
        );

        document.querySelector('#output').innerHTML = '-- All checks passed --';

        await lazyAddLink();
        // assert(defined.has(LAZY_CLASS), `${LAZY_CLASS} should be defined`);
      }

      window.addEventListener('load', function () {
        const checkcss = new CheckCSS();
        checkcss.scan();
        checkcss.watch();
        console.log(checkcss._state);
        setTimeout(() => console.log(checkcss._state), 100);
        runChecks(checkcss);
      });
    </script>
  </head>

  <body>
    <h1><code>CheckCSS</code> Browser Test</h1>

    <div id="output" class="MiSsInG_ClAsS"></div>
    <div class="text-warning bg-dark">Blarg</div>
  </body>
</html>
